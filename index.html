<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB5SbOv4dcwrWPz8-QTK9cY02e5a6xsHKY",
        authDomain: "myapp-bc1d6.firebaseapp.com",
        projectId: "myapp-bc1d6",
        storageBucket: "myapp-bc1d6.firebasestorage.app",
        messagingSenderId: "421966866384",
        appId: "1:421966866384:web:89b1028b297741951bfbd5",
        databaseURL: "https://myapp-bc1d6-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const userField = document.getElementById('username').value.trim();
        const passField = document.getElementById('password').value.trim();
        const btn = document.querySelector('button');

        btn.innerText = "جاري الاتصال بالسيرفر...";

        const dbRef = ref(db);
        
        // هنا الكود يروح لفرع login_info
        get(child(dbRef, `login_info`)).then((snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                
                // مطابقة البيانات (تأكد ان بالفايربيس مكتوبة user و pass حروف صغيرة)
                if (userField === data.user && passField === data.pass) {
                    window.location.href = "dashboard.html"; 
                } else {
                    alert("الرمز أو اسم المستخدم غلط.. تأكد من كتابتها بالسيرفر بنفس الشكل");
                    btn.innerText = "تسجيل الدخول";
                }
            } else {
                alert("السيرفر فارغ! لازم تضيف كلمة login_info وبداخلها user و pass");
                btn.innerText = "تسجيل الدخول";
            }
        }).catch((error) => {
            alert("فشل الاتصال: تأكد من ان الـ Rules في فايربيس هي true");
            console.error(error);
        });
    });
</script>
